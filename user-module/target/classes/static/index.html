<!--
 * index 页面
 *
 * @author 林佳评 陈可
 * @version 1.0
 * @since 2021-06-25 11:06:08
-->
<!--author 陈可，页面架构和UI实现，ajax交互，图标制作，js和css代码在assets包里面-->
<!--author：林佳评 JavaScript Ajax与数据渲染部分-->
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>基线数据采集分析云平台</title>

    <!-- Bootstrap CSS -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/app.css" rel="stylesheet">
    <link href="assets/css/icons.css" rel="stylesheet">
    <link rel="stylesheet" href="layui/css/layui.css">
    <script src="jquery/jquery-3.5.1.js"></script>
    <script src="layui/layui.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
</head>


<body>
<div class="layui-layout layui-layout-admin">

    <div class="layui-header">
        <div class="layui-logo layui-hide-xs layui-bg-black">基线分析云平台</div>
        <!-- 头部区域（可配合layui 已有的水平导航） -->
        <ul class="layui-nav layui-layout-left">
            <!-- 移动端显示 -->
            <li class="layui-nav-item layui-show-xs-inline-block layui-hide-sm" lay-header-event="menuLeft">
                <i class="layui-icon layui-icon-spread-left"></i>
            </li>

            <li class="layui-nav-item layui-hide-xs"><a href="">日志系统</a></li>
            <li class="layui-nav-item layui-hide-xs"><a href="">扩展系统</a></li>
            <li class="layui-nav-item">
                <a href="javascript:;">扩展组件</a>
                <dl class="layui-nav-child">
                    <dd><a href="">扩展组件01</a></dd>
                    <dd><a href="">扩展组件02</a></dd>
                </dl>
            </li>
        </ul>
        <ul class="layui-nav layui-layout-right">
            <li class="layui-nav-item layui-hide layui-show-md-inline-block">
                <a href="javascript:;" >
                    <span id="topBar"></span>
                    <img src="//tva1.sinaimg.cn/crop.0.0.118.118.180/5db11ff4gw1e77d3nqrv8j203b03cweg.jpg"
                         class="layui-nav-img layui-inline">
                    <h4 id="show" class="layui-inline" style="color: rgba(255,255,255,.7)"></h4>
                </a>
                <dl class="layui-nav-child">
                    <dd><a id="person_info">个人信息</a></dd>
                    <dd><a href="/logout">退出</a></dd>
                </dl>
            </li>
            <li class="layui-nav-item" lay-header-event="menuRight" lay-unselect>
                <a href="javascript:;">
                    <i class="layui-icon layui-icon-more-vertical"></i>
                </a>
            </li>
        </ul>
    </div>

    <div class="layui-side layui-bg-black">
        <div class="layui-side-scroll">
            <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
            <ul class="layui-nav layui-nav-tree" lay-filter="test">
                <li class="layui-nav-item">
                    <a class="" href="index.html">首页</a>
                </li>
                <li class="layui-nav-item layui-nav-itemed">
                    <a class="" href="historyshow.html">基线检查信息</a>
                    <dl class="layui-nav-child">
                        <dd><a href="historyshow.html">系统基本信息</a></dd>
                        <dd><a href="serviceInfo.html">系统服务信息</a></dd>
                        <dd><a href="patch_info.html">系统补丁信息</a></dd>
                        <dd><a href="autorun_info.html">自启动项信息</a></dd>
                        <dd><a href="policy_info.html">基线检查结果</a></dd>
                    </dl>
                </li>
                <li class="layui-nav-item">
                    <a class="" href="javascript:void(0);">系统管理</a>
                    <dl class="layui-nav-child">
                        <dd><a href="user.html">用户列表管理</a></dd>
                        <dd><a href="department.html">部门列表管理</a></dd>
                        <dd><a href="authManage.html">权限列表管理</a></dd>
                        <dd><a href="sendTask.html">扫描任务管理</a></dd>
                    </dl>
                </li>
            </ul>
        </div>
    </div>

    <div class="layui-body"  style="margin-top: 10px; margin-left: 10px; margin-right: 10px">
        <!-- 面包屑导航 -->
        <span class="layui-breadcrumb">
          <a href="index.html"><cite>首页</cite></a>
        </span>

        <!-- 水平线 -->
        <hr class="layui-bg-blue">
        <!--        <div class="page-wrapper">-->
        <div class="page-content">

            <div class="row" align="center">

                <div class="col-12 col-lg-6">
                    <div class="card radius-10">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div>
                                    <h6 class="mb-0">基线检测次数</h6>
                                </div>
                            </div>
                            <div class="chart-container-0 " id="chart">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-12 col-lg-6">
                    <div class="card radius-10">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div>
                                    <h6 class="mb-0">各检测项检测数量统计</h6>
                                </div>
                            </div>
                            <div class="chart-container-0" id="chart01">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row row-cols-1 row-cols-md-2 row-cols-xl-5" >

            <div class="col">
                <div class="card radius-10 overflow-hidden">
                    <div class="card-body">
                        <div class="d-flex align-items-center" >
                            <div>
                                <p class="mb-0 text-secondary font-14">普通管理员个数</p>
                                <h5 class="my-0" id="normal_admin"></h5>
                            </div>
                            <div class="text-primary ms-auto font-30"><i class='bx bx-cart-alt'></i>
                            </div>
                        </div>
                    </div>
                    <div class="mt-1" id="chart1"></div>
                </div>
            </div>

            <div class="col">
                <div class="card radius-10 overflow-hidden">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div>
                                <p class="mb-0 text-secondary font-14">超级管理员个数</p>
                                <h5 class="my-0" id="super_admin"></h5>
                            </div>
                            <div class="text-danger ms-auto font-30"><i class='bx bx-dollar' ></i>
                            </div>
                        </div>
                    </div>
                    <div class="mt-1" id="chart2"></div>
                </div>
            </div>

            <div class="col">
                <div class="card radius-10 overflow-hidden">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div>
                                <p class="mb-0 text-secondary font-14">基线检测总数</p>
                                <h5 class="my-0" id="check_totalnum"></h5>
                            </div>
                            <div class="text-success ms-auto font-30"><i class='bx bx-group'></i>
                            </div>
                        </div>
                    </div>
                    <div class="mt-1" id="chart3"></div>
                </div>
            </div>

            <div class="col">
                <div class="card radius-10 overflow-hidden">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div>
                                <p class="mb-0 text-secondary font-14">基线检测项目个数</p>
                                <h5 class="my-0" id="check_projectnum">56</h5>
                            </div>
                            <div class="text-warning ms-auto font-30"><i class='bx bx-beer'></i>
                            </div>
                        </div>
                    </div>
                    <div class="mt-1" id="chart4"></div>
                </div>
            </div>

            <div class="col">
                <div class="card radius-10 overflow-hidden">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div>
                                <p class="mb-0 text-secondary font-14">提权申请数</p>
                                <h5 class="my-0" id="upgrade_num">1</h5>
                            </div>
                            <div class="text-info ms-auto font-30"><i class='bx bx-camera-movie'></i>
                            </div>
                        </div>
                    </div>
                    <div class="mt-1" id="chart5"></div>
                </div>
            </div>
        </div><!--end row-->

        <table class="layui-hide" id="test" lay-filter="test"></table>



        <script type="text/html" id="barDemo">
            <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
        </script>


        <script type="text/html" id="person_form">
            <div class="layui-field-box">
                <div class="layui-form-item layui-form-pane">
                    <label class="layui-form-label">用户ID</label>
                    <div class="layui-input-block" style="margin-bottom: 5px">
                        <input type="text" id="person_id" class="layui-input" readonly style="background-color: khaki">
                    </div>
                    <label class="layui-form-label" >用户名称</label>
                    <div class="layui-input-block" style="margin-bottom: 5px">
                        <input type="text" id="person_username" class="layui-input" readonly style="background-color: khaki">
                    </div>
                    <label class="layui-form-label">用户角色</label>
                    <div class="layui-input-block" style="margin-bottom: 5px">
                        <input type="text" id="person_role" class="layui-input" readonly style="background-color: khaki">
                    </div>
                    <label class="layui-form-label">用户部门</label>
                    <div class="layui-input-block" style="margin-bottom: 5px">
                        <input type="text" id="person_department" class="layui-input" readonly style="background-color: khaki">
                    </div>
                    <label class="layui-form-label">密码</label>
                    <div class="layui-input-block" style="margin-bottom: 5px">
                        <input type="password" id="person_password" class="layui-input">
                    </div>
                    <label class="layui-form-label">手机号</label>
                    <div class="layui-input-block" style="margin-bottom: 5px">
                        <input type="text" id="person_phone" class="layui-input">
                    </div>
                    <label class="layui-form-label">状态</label>
                    <div class="layui-input-block" style="margin-bottom: 5px">
                        <input type="text" id="person_status" class="layui-input">
                    </div>
                    <label class="layui-form-label">最后登录时间</label>
                    <div class="layui-input-block" style="margin-bottom: 5px">
                        <input type="text" id="person_lastLoginTime" class="layui-input">
                    </div>
                </div>
            </div>
        </script>
    </div>
</div>






<script>
    $(function () {
        // 重置按钮
        $("#iReset").click(function () {
            $("#search_username").val("");
            $("#search_phone").val("");
            $("#search_login_time").val("");
            search();
        });

        // 查询按钮
        $("#searchVal").click(function () {
            const regexpSize = /([\s\S]*) 到 ([\s\S]*)/;
            var search_username = $("#search_username").val();
            var search_phone = $("#search_phone").val();
            var search_start_time = $("#search_login_time").val();
            var search_end_time = $("#search_login_time").val();
            if (search_start_time!=null && search_start_time!== "")
                search_start_time =search_start_time.match(regexpSize)[1];
            if (search_end_time!=null && search_end_time!== "")
                search_end_time = search_end_time.match(regexpSize)[2];

            // console.log()
            search(search_username, search_phone, search_start_time, search_end_time);
        });

        // 个人信息列表渲染
        $("#person_info").click(function () {
            var person_username = $("#show").html();
            var id;
            console.log(person_username)
            $.ajax({   // 异步请求   想象成线程状态
                url: "/admin/getUser",   // 请求路径
                type: "post",               // 请求的方式，不区分大小写   传递json不能使用get请求，否则返回400错误
                contentType: "application/json;charset=utf-8",
                datatype: "text",
                // request中传递的key-value值
                data: JSON.stringify({
                    username: person_username
                }),
                success: function (response) {                        // 后台服务响应成功，自动返回数据
                    $("#person_id").val(response.id);
                    id = response.id;
                    $("#person_username").val(response.adminName);
                    $("#person_password").val(response.adminPwd);
                    $("#person_phone").val(response.adminPhone);
                    $("#person_status").val(response.adminStatus);
                    $("#person_lastLoginTime").val(response.lastLoginTime);
                }
            });
            layer.open({
                type: 1
                ,title: '用户信息'         //不显示标题栏
                ,closeBtn: false
                ,area: ['600px','500px']  // 宽和高
                ,shade: 0.8               // 透明度
                ,id: 'LAY_layuipro'       //设定一个id，防止重复弹出
                ,btn: ['修改', '取消']    // 两个按钮显示的文字内容
                ,btnAlign: 'c'
                ,moveType: 1             //拖拽模式，0或者1
                ,content: $('#person_form').html()// 引入自定义表单
                ,success:function (layero,index) {
                    var laydate = layui.laydate;

                    //执行一个laydate实例
                    laydate.render({
                        elem: '#person_lastLoginTime'  //指定元素
                        , type: 'datetime'
                    });
                }
                ,btn1: function(index, layero){
                    var update_username = $("#person_username").val();
                    var update_status = $("#person_status").val();
                    var update_phone = $("#person_phone").val();
                    var last_login_time = $("#person_lastLoginTime").val();
                    var update_password = $("#person_password").val();

                    $.ajax({   // 异步请求   想象成线程状态
                        url:"/admin/updateById",   // 请求路径
                        type:"post",               // 请求的方式，不区分大小写   传递json不能使用get请求，否则返回400错误
                        contentType:"application/json;charset=utf-8",
                        datatype:"text",
                        // request中传递的key-value值
                        data:JSON.stringify({
                            id:id,
                            adminName:update_username,
                            adminPwd:update_password,
                            adminPhone:update_phone,
                            adminStatus:update_status,
                            lastLoginTime:last_login_time
                        }),
                        success:function(response){// 后台服务响应成功，自动返回数据
                            console.log(response)
                            if(response.code === 200) {
                                layer.close(index);   // 关闭当前对话框
                                alert("修改成功!");
                                search();
                            }
                            else {
                                alert("更新失败，请稍后重试!");
                            }
                        },
                        error:function(response){             // 网络请求失败，自动调用此方法
                            console.log("出错" + response);
                            layer.close(index);   // 关闭当前对话框
                        }
                    });
                    // 关闭弹出框

                    layer.close(index);
                }
            })
        });

        // 加载自运行查询
        search();
        // 查询函数
        function search(search_username, search_phone, search_start_time, search_end_time) {
            // 响应式  也就是适配不同的分辨率
            layui.use('table', function(){
                var table = layui.table;
                var json = {};
                if(search_username != null && search_username !== "")
                    json.search_username = search_username;
                if(search_phone != null && search_phone !== "")
                    json.search_phone = search_phone;

                if(search_start_time != null && search_start_time !== "")
                    json.search_start_time = search_start_time;
                if(search_end_time != null && search_end_time !== "")
                    json.search_end_time = search_end_time;
                console.log(json)


                table.render({   // 渲染table数据表格
                    elem: '#test'
                    ,url:'/sysinfo/selectAll'
                    ,where:json  // 添加的请求参数
                    ,toolbar: '#toolbarDemo' //开启头部工具栏，并为其绑定左侧模板
                    ,defaultToolbar: ['filter', 'exports', 'print', { //自定义头部工具栏右侧图标。如无需自定义，去除该参数即可
                        title: '提示'
                        ,layEvent: 'LAYTABLE_TIPS'
                        ,icon: 'layui-icon-tips'
                    }]
                    ,title: '用户表数据'
                    ,cols: [[
                        // {type: 'checkbox', fixed: 'left'},
                        {field:'id', title:'ID', width:100, fixed: 'left', unresize: true, sort: true, type: "numbers"}
                        ,{field:'hostname', title:'hostname', width:300, unresize: true}
                        ,{field:'ip', title:'ip', width:300, unresize: true}
                        ,{field:'osInfo', title:'os_info', width:300, unresize: true}
                        ,{field:'cpuType', title:'cpu_type', width:300, unresize: true}
                        ,{field:'cpuUsage', title:'cpu_usage', width:300, unresize: true}
                        ,{field:'totalMem', title:'total_mem', width:300, unresize: true}
                        ,{field:'usedMem', title:'used_mem', width:300, unresize: true}
                        ,{field:'memUsage', title:'mem_Usage', width:300, unresize: true}
                        ,{field:'checkTime', title:'check_time', width:300, unresize: true}
                        ,{fixed: 'right', title:'操作', toolbar: '#barDemo', width:150}
                    ]]
                    ,page: {limits:[10], prev:"上一页", next:"下一页"}
                    ,done: function (res, page, count) {
                        console.log(res);
                        // console.log(res.data[0].hostname);
                        console.log(page);
                        console.log(count);
                    }
                });

                //监听行工具事件
                table.on('tool(test)', function(obj){
                    var data = obj.data;   // layui返回的当前行中的json对象数据
                    //console.log(obj)
                    if(obj.event === 'del'){
                        layer.confirm('确定删除吗?', function(index){
                            $.ajax({   // 异步请求   想象成线程状态
                                url:"/sysinfo/deleteById",   // 请求路径
                                type:"post",               // 请求的方式，不区分大小写   传递json不能使用get请求，否则返回400错误
                                datatype:"text",
                                // request中传递的key-value值
                                data:{
                                    id:data.id
                                },
                                success:function(response){                        // 后台服务响应成功，自动返回数据
                                    if(response.code === 200) {
                                        layer.close(index);   // 关闭当前对话框
                                        alert("删除成功!");
                                        search();
                                    }
                                    else {
                                        alert("删除失败，请稍后重试!");
                                    }
                                },
                                error:function(response){             // 网络请求失败，自动调用此方法
                                    console.log("出错" + response);
                                    layer.close(index);   // 关闭当前对话框
                                }
                            });
                        });
                    } else if(obj.event === 'edit'){
                        //弹出表单
                        layer.open({
                            type: 1
                            ,title: '查看用户'         //不显示标题栏
                            ,closeBtn: false
                            ,area: ['400px','300px']  // 宽和高
                            ,shade: 0.8               // 透明度
                            ,id: 'LAY_layuipro'       //设定一个id，防止重复弹出
                            ,btn: ['确定', '取消']    // 两个按钮显示的文字内容
                            ,btnAlign: 'c'
                            ,moveType: 1             //拖拽模式，0或者1
                            ,content: $('#update_form').html()// 引入自定义表单
                            ,success:function (layero,index) {
                                var laydate = layui.laydate;

                                //执行一个laydate实例
                                laydate.render({
                                    elem: '#update_lastLoginTime'  //指定元素
                                    ,type: 'datetime'
                                });
                            }
                            ,btn1: function(index, layero){
                                var update_phone = $("#update_phone").val();
                                var last_login_time = $("#update_lastLoginTime").val();

                                $.ajax({   // 异步请求   想象成线程状态
                                    url:"/admin/selectAll",   // 请求路径
                                    type:"post",               // 请求的方式，不区分大小写   传递json不能使用get请求，否则返回400错误
                                    contentType:"application/json;charset=utf-8",
                                    datatype:"text",
                                    // request中传递的key-value值
                                    data:JSON.stringify({
                                        id:data.id,
                                        adminPhone:update_phone,
                                        lastLoginTime:last_login_time
                                    }),
                                    success:function(response){                        // 后台服务响应成功，自动返回数据
                                        if(response.code === 200) {
                                            layer.close(index);   // 关闭当前对话框
                                            alert("更新成功!");
                                            search();
                                        }
                                        else {
                                            alert("更新失败，请稍后重试!");
                                        }
                                    },
                                    error:function(response){             // 网络请求失败，自动调用此方法
                                        console.log("出错" + response);
                                        layer.close(index);   // 关闭当前对话框
                                    }
                                });
                                // 关闭弹出框
                                layer.close(index);
                            }
                            ,success: function(layero){
                                $("#update_username").val(data.adminName);
                                $("#update_phone").val(data.adminPhone);
                                $("#update_lastLoginTime").val(data.lastLoginTime);
                            }
                        });
                    }
                });
            });
        }
        $("body").on('click', '.layui-table-body tr ', function () {
            console.log(this);
            var data_index = $(this).attr('data-index');//得到当前的tr的index
            console.log($(this).attr('data-index'));
            for (var i = 0 ; i < countNum; i++)//countNum为总行数
            {
                if (i % 2 == 0) { //设置隔行换色
                    $(".layui-table-body tr[data-index=" + i + "]").attr({ "style": "background:#D1EEEE;color:black" });//恢复原有tr颜色
                } else {
                    $(".layui-table-body tr[data-index=" + i + "]").attr({ "style": "background:#fff;color:black" });//恢复原有tr颜色
                }
            }
            $(".layui-table-body tr[data-index=" + data_index + "]").attr({ "style": "background:#1E9FFF;color:#fff" });//改变当前tr颜色

        });

        // 请求获取个人用户姓名
        $.ajax({
            url:"/shiro/check",
            type:"post",
            datatype:"text",
            data:{},
            success:function(response){
                // 显示登录者姓名到页面进行渲染
                $("#show").html(response.username);
            },
            error:function(response){
                console.log("出错" + response);
            }
        })

        //判断是否为超级用户
        checkadmin();
        function checkadmin(){
            $.ajax({
                url:"/shiro/check",                               			 // 请求路径   请求服务器的哪一个接口
                type:"post",                                     // 请求的方式，不区分大小写   传递json不能使用get请求，否则返回400错误
                datatype:"text",
                data:{},
                success:function(response){
                    // 加载用户名称和动态的申请权限
                    $("#show").html(response.username);
                    console.log(response);
                    var userid = response.userId;
                    console.log(response.userId);
                    // alert(userid);
                    if (userid == "0") {
                        var list = document.getElementById("topBar");
                        var liObj = document.createElement("li");
                        liObj.setAttribute("class", "layui-nav-item layui-hide layui-show-md-inline-block");
                        //创建<a id="upgrade">申请提权</a>
                        var innerHtml = document.createElement("a");
                        innerHtml.setAttribute("id", "upgrade");
                        innerHtml.setAttribute("href", "javascript:;");
                        innerHtml.innerHTML = "申请提权";
                        liObj.appendChild(innerHtml);
                        list.appendChild(liObj);
                    }
                },
                error:function(response){                        // 网络请求失败，自动调用此方法
                    console.log("出错" + response);
                }
            });
        };

        $("#topBar").on('click','#upgrade',function(){

            var person_username = $("#show").html();

            $.ajax({
                url: "/upgrade/insert",
                type: "post",
                contentType: "application/json;charset=utf-8",
                datatype: "text",
                data: JSON.stringify({
                    username: person_username,
                    state: '待处理'
                }),
                success: function (response) {
                    console.log(response);
                    if (response.code === 200){
                        alert("申请已提交，等待管理员审核。");
                    }else{
                        alert("申请已提交，请重新登录查看审核结果。");
                    }
                }
            });
            //doSomething;
        });

        get_baseline_check_info();
        function get_baseline_check_info() {
            $.ajax({
                url:"/sysinfo/countById",
                type:"get",
                datatype:"text",
                success:function(response){
                    console.log(response);
                    document.getElementById("check_projectnum").innerHTML = response.data;
                },
                error:function(response){
                    console.log(response);
                }
            });
        }

        get_baseline_check_total();
        function get_baseline_check_total() {
            $.ajax({
                url:"/shiro/countById",
                type:"get",
                datatype:"text",
                success:function(response){
                    console.log(response);
                    document.getElementById("check_totalnum").innerHTML = response.data;
                },
                error:function(response){
                    console.log(response);
                }
            });
        }

        get_admin_num();
        function get_admin_num() {
            $.ajax({
                url:"/redis/getAdminNum",
                type:"get",
                datatype:"text",
                success:function(response){
                    console.log(response);
                    document.getElementById("normal_admin").innerHTML = response.normal_admin_num;
                    document.getElementById("super_admin").innerHTML = response.super_admin_num;
                },
                error:function(response){
                    console.log(response);
                }
            });
        }
    });
</script>

<!--柱状图-->
<script type="text/javascript">
    var dom = document.getElementById("chart01");
    var myChart = echarts.init(dom);
    var app = {};

    var option2;

    option2 = {
        xAxis: {
            type: 'category',
            data: ['基本信息', '服务信息', '补丁信息', '自启动项', '基线检查']
        },
        yAxis: {
            type: 'value'
        },
        series: [{
            data: get_check_num(),
            type: 'bar',
            itemStyle: {
                color: '#4a8fb2'
            }
        }]
    };

    if (option2 && typeof option2 === 'object') {
        myChart.setOption(option2);
    }

    function get_check_num() {
        // var sysinfo_num = get_sysinfo_num();
        // var serviceinfo_num = get_serviceinfo_num();
        // var patchinfo_num = get_patchinfo_num();
        // var autorun_num = get_autoruninfo_num();
        // var baselineinfo_num = get_baselineinfo_num();
        //
        // var check_num = [sysinfo_num, serviceinfo_num, patchinfo_num, autorun_num, baselineinfo_num];
        // // var total_num = sysinfo_num+serviceinfo_num+patchinfo_num+autorun_num+baselineinfo_num;
        //
        // console.log("check_num")
        // console.log(check_num);
        // document.getElementById("check_totalnum").innerHTML = total_num;
        // return check_num;
        var allCounts = [];
        $.ajax({
            url:"/shiro/getAllCounts",
            type:"get",
            datatype:"text",
            async:false,
            success:function(response){
                allCounts = response.data;
            },
            error:function(response){
                console.log(response);
                return 1;
            }
        });
        console.log(allCounts);
        return allCounts;
    }

    function get_sysinfo_num() {
        $.ajax({
            url:"/sysinfo/selectAll",
            type:"get",
            datatype:"text",
            async:false,
            success:function(response){
                var sysinfo_num = response.data.length;
                console.log("sysinfo_num "+sysinfo_num);
                return sysinfo_num;
            },
            error:function(response){
                console.log(response);
                return 1;
            }
        });
    }
    function get_serviceinfo_num() {
        $.ajax({
            url:"/serviceinfo/selectAll",
            type:"get",
            datatype:"text",
            async:false,
            success:function(response){
                var serviceinfo_num = response.list.length;
                console.log("serviceinfo_num "+serviceinfo_num);
                return serviceinfo_num;
            },
            error:function(response){
                console.log(response);
                return 1;
            }
        });
    }
    function get_patchinfo_num() {
        $.ajax({
            url:"/patchinfo/selectAll",
            type:"get",
            datatype:"text",
            async:false,
            success:function(response){
                var patchinfo_num = response.list.length;
                console.log("patchinfo_num "+patchinfo_num);
                return patchinfo_num;
            },
            error:function(response){
                console.log(response);
                return 1;
            }
        });
    }
    function get_autoruninfo_num() {
        $.ajax({
            url:"/firstbootinfo/selectAll",
            type:"get",
            datatype:"text",
            async:false,
            success:function(response){
                var autoruninfo_num = response.list.length;
                console.log("autoruninfo_num "+autoruninfo_num);
                return autoruninfo_num;
            },
            error:function(response){
                console.log(response);
                return 1;
            }
        });
    }
    function get_baselineinfo_num() {
        $.ajax({
            url:"/baselineinfo/selectAll",
            type:"get",
            datatype:"text",
            async:false,
            success:function(response){
                var baselineinfo_num = response.list.length;
                console.log("baselineinfo_num "+baselineinfo_num);
                return baselineinfo_num;
            },
            error:function(response){
                console.log(response);
                return 1;
            }
        });
    }
</script>

<!--折线图-->
<script type="text/javascript">
    var dom = document.getElementById("chart");
    var myChart = echarts.init(dom);
    var app = {};
    var option;

    $.ajax({
        url:"sysinfo/selectAllTimestamp",
        type:"get",
        datatype:"text",
        data:{},
        success:function(response){
            var dic = {"星期一":0, "星期二":0, "星期三":0, "星期四":0, "星期五":0, "星期六":0, "星期日":0};
            data = response.data;
            console.log(response);
            for(var i = 0; i<data.length; i++){
                dic[data[i]]++;
            }
            var count = [dic["星期一"], dic["星期二"], dic["星期三"], dic["星期四"], dic["星期五"], dic["星期六"], dic["星期日"]];

            option = {
                title: {
                    // text: 'Visit history',    //统计图标题名称
                },
                tooltip: {   //提示框
                    trigger: 'axis',  //触发类型  axis：坐标轴触发  item：项目触发
                    formatter: function (data) {        //自定义提示框 （参数自定义）
                        var r=data[0].data*10;
                        r=r.toFixed(2);  //保留两位小数
                        return data[0].name+'<br/>'+'统计次数为:'+data[0].data;
                    }
                    /*  axis类型时  data是多个系列的数据数组
                    data[0].name   横坐标
                    data[0].seriesName   图例名称
                    data[0].data   纵坐标

                    item类型时不是数组
                    */

                },
                toolbox: {   //工具箱
                    show: true, //是否显示工具箱
                    saveAsImage: {} ,//下载工具
                    feature: {
                        mark: { show: true },  //辅助线开关
                        dataView: { show: true, readOnly: false },  //数据视图
                        magicType: { show: true, type: ['line', 'bar', 'stack', 'tiled'] },
                        restore: { show: true },   //还原
                        saveAsImage: { show: true }  //保存为图片
                    }
                },
                xAxis: {
                    type: 'category',
                    data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    axisLabel: {
                        show: true,
                        textStyle: {
                            fontSize: 14,    // 改变x轴字体大小

                        }
                    }
                },
                yAxis: {
                    type: 'value'
                },
                series: [{
                    data: count,
                    type: 'line',

                    smooth: true
                }]
            };

            if (option && typeof option === 'object') {
                myChart.setOption(option);
            }
            myChart.setOption(option);
            //添加点击事件
            function eConsole(param) {

                //alert(option.series[0].data.length);  //长度

                //alert(option.series[0].data[i]);   //内容

                //param.dataIndex 获取当前点击索引，

                var index=param.dataIndex;
            }
            myChart.on("click", eConsole);

        },
        error:function(response){
            console.log("绘制基线检测次数折线图失败");
            console.log(response);
        }
    })

    option = {
        title: {
            // text: 'Visit history',    //统计图标题名称
        },
        tooltip: {   //提示框
            trigger: 'axis',  //触发类型  axis：坐标轴触发  item：项目触发
            formatter: function (data) {        //自定义提示框 （参数自定义）
                var r=data[0].data*10;
                r=r.toFixed(2);  //保留两位小数
                return data[0].name+'<br/>'+'统计次数为:'+data[0].data;
            }

        },
        toolbox: {   //工具箱
            show: true, //是否显示工具箱
            saveAsImage: {} ,//下载工具
            feature: {
                mark: { show: true },  //辅助线开关
                dataView: { show: true, readOnly: false },  //数据视图
                magicType: { show: true, type: ['line', 'bar', 'stack', 'tiled'] },
                restore: { show: true },   //还原
                saveAsImage: { show: true }  //保存为图片
            }
        },
        xAxis: {
            type: 'category',
            data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
            axisLabel: {
                show: true,
                textStyle: {
                    fontSize: 14,
                }
            }
        },
        yAxis: {
            type: 'value'
        },
        series: [{
            data: [8, 7, 9, 6, 12, 10, 13],
            type: 'line',

            smooth: true
        }]
    };

    if (option && typeof option === 'object') {
        myChart.setOption(option);
    }
    myChart.setOption(option);
    //添加点击事件
    function eConsole(param) {
        var index=param.dataIndex;
    }
    myChart.on("click", eConsole);

</script>


<script>
    //JS
    layui.use('laydate', function(){
        var laydate = layui.laydate;

        //执行一个laydate实例
        laydate.render({
            elem: '#search_login_time'  //指定元素
            ,type:'datetime'
            ,range:'到'
        });
    });
    layui.use(['element', 'layer', 'util'], function(){
        var element = layui.element
            ,layer = layui.layer
            ,util = layui.util
            ,$ = layui.$;

        //头部事件
        util.event('lay-header-event', {
            //左侧菜单事件
            menuLeft: function(othis){
                layer.msg('展开左侧菜单的操作', {icon: 0});
            }
            ,menuRight: function(){
                layer.open({
                    type: 1
                    ,content: '<div style="padding: 15px;">处理右侧面板的操作</div>'
                    ,area: ['260px', '100%']
                    ,offset: 'rt' //右上角
                    ,anim: 5
                    ,shadeClose: true
                });
            }
        });

    });
    layui.use('upload', function(){
        var upload = layui.upload;

        //执行实例
        upload.render({
            elem: '#'
            ,url: ''                        //改成您自己的上传接口
            ,done: function(res){
                layer.msg('上传成功');
                layui.$('#uploadDemoView').removeClass('layui-hide').find('img').attr('src', res.files.file);
                console.log(res)
            }
        });
    });

    //拖拽上传

</script>

<script src="assets/plugins/sparkline-charts/jquery.sparkline.min.js"></script>

<script src="assets/js/index2.js"></script>

</body>
</html>
